// Pentest originals //

/obj/structure/closet/crate/pentest
	icon = 'modular_pentest/master_files/icons/obj/crates.dmi'

/obj/structure/closet/crate/pentest/gold
	name = "gold crate"
	desc = "A shiny, gold-colored crate."
	icon_state = "gold"

/obj/structure/closet/crate/pentest/diamond
	name = "diamond crate"
	desc = "A diamond crate. Well, it's not actually diamond, but it looks nice."
	icon_state = "diamond"

/obj/structure/closet/crate/pentest/pink
	name = "pink crate"
	desc = "A glittery pink crate."
	icon_state = "pink"

/obj/structure/closet/crate/pentest/lavender
	name = "lavender crate"
	desc = "A glittery purple... wait, no, lavender crate."
	icon_state = "lavender"

/obj/structure/closet/crate/pentest/emerald
	name = "emerald crate"
	desc = "A glittery emerald crate."
	icon_state = "pink"

// Abandoned Clown Crate (also a Pentest original) (wow thank you blue cat) //

/obj/structure/closet/crate/secure/loot/clown // Keep those clowns locked up
	name = "abandoned clown crate"
	desc = "You hear faint laughter from within..."
	icon = 'modular_pentest/master_files/icons/obj/crates.dmi'
	icon_state = "clown"
	codelen = 4
	attempts = 10
	qdel_on_open = FALSE
	spawned_loot = FALSE
	tamperproof = 90

/obj/structure/closet/crate/secure/loot/clown/Initialize()
	. = ..()
	if(locked)
		lock()

/obj/structure/closet/crate/secure/loot/clown/lock()
	cut_overlays()
	add_overlay(image('icons/obj/closets.dmi', "securecrater")) // pulls from the shiptest for the lock overlay

/obj/structure/closet/crate/secure/loot/clown/unlock()
	cut_overlays()
	add_overlay(image('icons/obj/closets.dmi', "securecrateg"))

/obj/structure/closet/crate/secure/loot/clown/attack_hand(mob/user)
	if(locked)
		to_chat(user, span_notice("The crate is locked with a Deca-code lock."))
		var/input = input(usr, "Enter [codelen] digits. All digits must be unique.", "Deca-Code Lock", "") as text|null
		if(user.canUseTopic(src, BE_CLOSE))
			var/list/sanitised = list()
			var/sanitycheck = TRUE
			var/char = ""
			var/length_input = length(input)
			for(var/i = 1, i <= length_input, i += length(char))
				char = input[i]
				sanitised += text2num(char)
			for(var/i = 1, i <= length(sanitised) - 1, i++)
				for(var/j = i + 1, j <= length(sanitised), j++)
					if(sanitised[i] == sanitised[j])
						sanitycheck = FALSE
			if(input == code)
				to_chat(user, span_notice("The crate unlocks with a honk!"))
				locked = FALSE
				unlock()
				tamperproof = 0
				if(!spawned_loot)
					spawn_loot()
			else if(!input || !sanitycheck || length(sanitised) != codelen)
				to_chat(user, span_notice("You leave the funny crate alone."))
				lock()
			else
				to_chat(user, span_warning("A red light flashes."))
				lastattempt = input
				attempts--
				lock()
				if(attempts == 0)
					boom(user)
	else
		return ..()

/obj/structure/closet/crate/secure/loot/clown/spawn_loot()
	var/loot = rand(1, 20)
	switch(loot)
		if(1 to 3)
			new /obj/item/clothing/suit/space/hardsuit/clown(src)
			new /obj/item/clothing/head/helmet/space/hardsuit/clown(src)
		if(4 to 5)
			new /obj/item/clothing/shoes/clown_shoes/banana_shoes(src)
			// add hellstone to power it
		if(6 to 7)
			new /obj/item/pneumatic_cannon/pie/selfcharge(src)
			new /obj/item/clothing/mask/gas/clown_hat(src)
		if(8)
			new /obj/item/clothing/mask/gas/sexyclown(src)
			new /obj/item/clothing/under/rank/civilian/clown/sexy(src)
		if(9 to 10)
			new /obj/item/clothing/under/rank/civilian/clown/jester(src)
			new /obj/item/clothing/head/jester(src)
			// other jester stuff?
		if(11 to 13)
			new /obj/item/toy/figure/clown(src)
			// add something here
		if(14 to 15)
			// uhh
		if(16 to 17)
			// idk
		if(18)
			new /obj/item/shield/energy/bananium(src)
		if(19)
			new /obj/item/melee/energy/sword/bananium(src)
		if(20)
			new /obj/item/clothing/mask/gas/mime(src)

			// Mime stuff?
	spawned_loot = TRUE
