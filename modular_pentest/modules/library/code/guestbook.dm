// Guestbooks //

/obj/item/book/guestbook
	name = "guestbook"
	desc = "A leatherbound book where guests can write their well wishes."
	icon = 'modular_pentest/modules/library/icons/library.dmi'
	icon_state = "guestbook_brown"
	item_state = "guestbook_brown"
	attack_verb = list("greeted", "welcomed") // hehe
	var/list/entries = list()
	var/book_locked = FALSE // lets you lock the book and prevent new entries from being added

// Use in hand to sign the guestbook
/obj/item/book/guestbook/attack_hand(mob/user)
	if(book_locked)
		to_chat(user, "<span class='notice'>The guestbook is closed for signing.</span>")
	else
		var/message = input(user, "Write a message in the guestbook.", "Guestbook", "") as message
		if(message && length(message))
			var/time = time2text(world.realtime, "MMM DD, YYYY - hh:mm")
			entries += "<b>[user.real_name]</b> ([time]): [html_encode(message)]"
			to_chat(user, "<span class='notice'>You sign the guestbook with your message.</span>")

	show_entries(user)

// View existing entries after signing
/obj/item/book/guestbook/proc/show_entries(mob/user)
	if(!entries || !length(entries))
		to_chat(user, "<span class='notice'>The guestbook is currently empty.</span>")
		return

	var/text = "<h2>Wedding Guestbook</h2><hr>"
	for(var/entry in entries)
		text += "[entry]<br><br>"

	user << browse(text, "window=guestbook_entries;size=500x600")

// Or right-click to view without signing
/obj/item/book/guestbook/verb/view_guestbook()
	set name = "View Guestbook"
	set category = "Object"
	set src in view(1)
	set popup_menu = TRUE

	if(usr)
		show_entries(usr)

// Lock it when you're done
/obj/item/book/guestbook/verb/lock_book()
	set name = "Lock Guestbook"
	set category = "Object"
	set src in view(1)
	set popup_menu = TRUE

	if(!usr)
		return

	if(book_locked)
		to_chat(usr, "<span class='notice'>The guestbook is already locked.</span>")
		return

	var/response = alert(usr, "Are you sure you want to lock the guestbook? No one will be able to sign it after this.", "Confirm Lock", "Yes", "No")
	if(response != "Yes")
		to_chat(usr, "<span class='notice'>You decide not to lock the guestbook.</span>")
		return

	book_locked = TRUE
	to_chat(usr, "<span class='notice'>You lock the guestbook. No more entries can be signed.</span>")

// Variety is the spice of life //

/obj/item/book/guestbook/blue
	name = "white guestbook"
	desc = "An elegant white guestbook where guests can write their well wishes."
	icon_state = "guestbook_white"
	item_state = "guestbook_white"

/obj/item/book/guestbook/blue
	name = "red guestbook"
	desc = "A romantic red guestbook where guests can write their well wishes."
	icon_state = "guestbook_red"
	item_state = "guestbook_red"

/obj/item/book/guestbook/blue
	name = "blue guestbook"
	desc = "A brilliant blue guestbook where guests can write their well wishes."
	icon_state = "guestbook_blue"
	item_state = "guestbook_blue"
